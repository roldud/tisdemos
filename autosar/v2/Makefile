# demo of autosar features
# Copyright (C) 2024 TrustInSoft
# mailto:contact AT trust-in-soft DOT com
#
CONFIG_DIR := trustinsoft
CONFIG_FILE := $(CONFIG_DIR)/config.json

RESULTS_DIR := $(CONFIG_DIR)/results
LOGS_DIR := $(CONFIG_DIR)/logs
SAVE_DIR := $(CONFIG_DIR)/save

SHELL := /bin/bash
FONT_BOLD := `tput bold`
FONT_CYAN := `tput setaf 6`
FONT_RED := `tput setaf 1`
FONT_RESET := `tput sgr0`

.PHONY: all tis report clean count_ub

all:
	@echo "make gen:     Automatically generates TrustInSoft Analysis drivers from ARXML"
	@echo "make tis:     Automatically runs analysis drivers generated by 'make gen'"
	@echo "make clean:   Deletes all analysis drivers and analysis execution reports"

gen:
	@echo -e "$(FONT_CYAN)tis-autosar --check-output --arxml ConsumptionApplication.arxml -o $(CONFIG_DIR)$(FONT_RESET)"
	@tis-autosar --check-output --arxml ConsumptionApplication.arxml -o $(CONFIG_DIR)
	@echo '{"files": ["../ConsumptionApplication.c"]}' > $(CONFIG_DIR)/persistent_config.json

run_all:
	@echo -e "$(FONT_CYAN)tis-analyzer -tis-config-load $(CONFIG_FILE) -tis-config-select-by-name ConsumptionApplication_EstimateConsumption -tis-report-directory $(CONFIG_DIR)$(FONT_RESET)"
	@tis-analyzer-gui -machdep x86_64 -tis-config-load $(CONFIG_FILE) -tis-config-select-by-name ConsumptionApplication_EstimateConsumption -tis-report-directory $(CONFIG_DIR)


tis: run_all report

report:
	@tis-report $(CONFIG_DIR)/ --skip-file rte_mocks.c
	@printf "\nCheck generated test report:\n$(FONT_CYAN)xdg-open tis_report.html$(FONT_RESET)\n\n"

clean:
	@echo "Cleaning: Removing all automatically generated files"
	@rm -rf $(CONFIG_DIR)/ tis_report.html *~


